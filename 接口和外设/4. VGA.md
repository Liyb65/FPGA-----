# 基本概念
图像显示设备在日常生活中随处可见，例如家庭电视机、计算机显示屏幕等，这些设备之所以能够显示我们需要的数据图像信息，归功于视频传输接口

**常见的视频传输接口有三种：VGA接口、DVI接口和HDMI接口**，目前的显示设备都配有这三种视频传输接口

三类视频接口的发展历程为VGA → DVI → HDMI。其中VGA接口出现的最早，只能传模拟图像信号；DVI可以传输数字图像信号；HDMI在传输数字图像信号的基础上又可以传输音频信号

VGA（Video Graphics Array），译为视频图形阵列，是一种使用模拟信号进行视频传输的标准协议，由IBM公司于1987年推出，因其分辨率高、显示速度快、颜色丰富等优点，广泛应用于彩色显示器领域

由于VGA接口体积较大，与追求小巧便捷的笔记本电脑背道而驰，在笔记本领域，VGA接口已被逐渐淘汰，但对于体积较大的台式机，这种情况并未发生

虽然VGA标准在当前个人电脑市场已经过时，但因其在显示标准中的重要性和良好的兼容性，VGA仍是最多制造商所共同支持的一个标准，个人电脑在加载自己独特驱动程序之前，都必须支持VGA标准

早期的CRT显示器只能接收模拟信号，不能接收数字信号，计算机内部显卡将数字信号转换为模拟信号，通过VGA接口传给VGA显示器，虽然现如今许多种类的显示器可以直接接收数字信号，但为了兼容显卡的VGA接口，大多支持VGA标准

VGA接口以针式引出信号线的称为公头，以孔式引出信号线的称为母头。在计算机和VGA显示器上一般引出母头接口，使用两头均为公头的VGA连接线将计算机与VGA显示器连接起来，两者图像传输时，使用的是VGA图像标准

<img src = fig4\图片1.png style=zoom:50%>

VGA显示器显示图像，并不是直接让图像在显示器上显示出来，而是采用扫描的方式，将构成图像的像素点，在行同步和场同步信号的同步下，按照从上到下、从左到右的顺序扫描到显示屏上

<img src = fig4\图片2.png style=zoom:60%>

结合VGA显示器扫描方式示意图，可以看到VGA显示器的扫描规律如下：

1、在行、场同步信号的同步下，扫描坐标定位到左上角第一个像素点坐标

2、自左上角（第一行）第一个像素点坐标，逐个像素点向右扫描（图中第一个水平方向箭头）

3、扫描第一行最后一个数据，一行图像扫描完成，进行图像消隐，扫描坐标自第一行行尾转移到第二行行首（图中第一条虚线）

4、重复若干次扫描至最后一行行尾，一帧图像扫描完成，进行图像消隐，扫描坐标跳转回到左上角第一行行首（图中对角线箭头），开始下一帧图像的扫描

在扫描的过程中会对每一个像素点进行单独赋值，使每个像素点显示对应色彩信息，当一帧图像扫描结束后，开始下一帧图像的扫描，循环往复，当扫描速度足够快，加之人眼的视觉暂留特性，我们会看到一幅完整的图片，而不是一个闪烁的像素点，这就是VGA显示的原理

# VGA时序标准
为了适应匹配不同厂家的VGA显示器，VGA视频传输接口有自己的一套VGA时序标准、只有遵循VGA的时序标准，才能正确的进行图像信息显示。在这里以VESA VGA时序标准为例

<img src = fig4\图片3.png>

由VESA VGA时序标准图可知，VGA时序由两部分组成，行同步时序和场同步时序

## 行同步时序

<img src = fig4\图片4.png>

上图中，Video代表传输的图像信息，HSync表示行同步信息，HSync自上升沿起到下一个上升沿止为一个完整周期，称为行扫描周期

一个完整的行扫描周期，包含6部分：Sync（同步）、Back Porch（后沿）、Left Border（左边框）、Addressable Video（有效图像）、Right Border（右边框）、Front Porch（前沿），这六部分的**基本单位是像素**，即一个像素时钟周期

在一个完整的行扫描周期中，Video图像信息在HSync行同步信号的同步下完成一行图像的扫描显示，Video图像信息只有在Addressable Video阶段有效，其它阶段图像信息无效

HSync行同步信号在Sync（同步）阶段，维持高电平，其它阶段均保持低电平，在下一个行扫描周期的Sync（同步）阶段，HSync行扫描信号会再次拉高，其它阶段拉低，周而复始

## 场同步时序

<img src = fig4\图片5.png>

上图Video表示传输的图像信息，VSync表示场同步信号，VSync自上升沿起到下一个上升沿止为一个完整周期，称为场扫描周期

一个完整的场扫描周期，包含6部分：Sync（同步）、Back Porch（后沿）、Top Border（上边框）、Addressable Video（有效图像）、Bottom Border（底边框）、Front Porch（前沿），与行同步信号不同的是，这6部分的**基本单位是line（行）**，即一个完整的行扫描周期

在一个完整的场扫描周期中，Video图像信息在HSync（行同步信号）和VSync（场同步信号）的共同作用下完成一帧图像的显示，**Video图像信息只有在Addressable Video（有效图像）阶段，图像信息有效，其它阶段图像信息无效**

VSync 行同步信号在 Sync（同步）阶段，维持高电平，其他阶段均保持低电平，完成一个场扫描周期后，进入下一帧图像的扫描。综上所述，将行同步时序图与场同步时序图结合起来就构成了 VGA 时序图

<img src = fig4\图片6.png>

<img src = fig4\图片7.png>

时钟频率的计算方式：

以$640 \times 480 @ 60$的显示模式为例，其一帧总的像素为$800 \times 525$，一共有60帧，总共有$800 \times 525 \times 60 = 25 200000$个像素，也就是25.2MHz

# Xilinx VGA IP
Video Timing Controller

## Detection/Generation

<img src = fig4\图片8.png>

AXI-Lite总线可以用于在不断电的情况下动态的切换分辨率，如果没有动态分辨率需求，可以不勾选

四个Option Features一般都可以不勾选

**Max Clocks Per Line**：每一行最大像素数

**Max Lines Per Frame**：每帧最大有多少个行

**Enable Generation**：使能生成，使得IP核能够生成VGA时序

**Enable Detection**：使能检测，一般不勾

Vertical Blank Generation和Horizontal Blank Generation一般不勾，用不到

## Default/Constant

只选择分辨率，其余保持默认即可

## 配置结果

```verilog
VGA your_instance_name (
  .clk(clk),                            // input wire clk
  .clken(1'b1),                        // input wire clken
  .gen_clken(gen_clken),                // input wire gen_clken
  .hsync_out(hsync_out),                // output wire hsync_out
  .vsync_out(vsync_out),                // output wire vsync_out
  .active_video_out(active_video_out),  // output wire active_video_out
  .resetn(resetn),                      // input wire resetn
  .fsync_out()                // output wire [0 : 0] fsync_out
);
```

gen_clken是VGA时序生成的使能标志，让VGA时序开始产生，一般该模块前面接的是一个DDR，等DDR数据准备好后，再让时序开始产生；可以保证每次拿到的都是一个完整的帧，这个信号设置为1将导致一上电就生成时序，不能保证从哪里取可以得到完整的帧；即起着DDR和该模块同步的作用

可以看到vga这一IP核只生成了HSync、VSync和数据使能信号，并没有生成数据，所以要对该IP进行封装，生成数据



