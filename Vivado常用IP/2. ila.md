# 资源消耗
主要消耗BRAM资源，采样深度越大，消耗的BRAM资源越多


# 面向问题
1、仿真正确，但是上板结果出错
2、工程复杂，代码量巨大，测试文件不太好编写
3、ILA使得我们可以在板子上分析波形，分析实际与想法是否符合

# 常用参数
**Sample Data Depth**：数据采样深度，深度越大，消耗的BRAM越多，深度越大，采样的波形周期数越大
**Number of Probes**：要观察的信号数，高位宽的信号也被视为一个信号
**Probe Width**：该探针所观测信号的位宽

其它设置保持默认即可
其中Capture Control和Advanced Trigger建议勾选上，和后面的控制面板相对应，不勾选也没什么影响
<img src = fig2/ila_configure.png>

烧录程序时可以看到除了（.bit）外，还有调试文件（.ltx）
<img src = fig2/program_device.png style = "zoom:80%">

将ila抓取到的信号拖到ila窗口右下角的trigger settup处，可以设置信号的表示形式和采样时刻，波形图中的红线表示采样时刻
<img src = fig2/ila_debug.png style = "zoom:70%">

**注意**
1、我们要抓取的信号是在哪个时钟域下产生的，ila的输入时钟就应该是哪个时钟，其它输入是ILA要抓取的信号
2、不要抓取时钟信号

# ila调试窗口（Setting）中的参数
**window data depth**：窗口中显示的周期数，最大不会超过ila ip核的深度
**trigger position in window**：波形窗口中红色线出现的位置

# 逻辑仪运行方式
如下图所示，红色区域表示了ILA的两种运行方式。run trigger for this ila core这一方式根据trigger setup处设置的触发模式触发运行；rum trigger immediate for this ila core将忽略设置的触发模式，任意运行
<img src=fig2/ila_debug4.png style="zoom:70%">

# 常见问题
**1、如果烧录后，ILA窗口没有信号是空着的，点击下图中的加号，就可以将抓取到的信号添加到波形窗口**
<img src=fig2/ila_debug1.png style="zoom:70%">

**2、对于很多个不同位宽的信号，直接将探针位宽设置为一个较大的数**，如100，此时例化为
```verilog
ila_0 inst (
    .clk(clk), // input wire clk
    .probe0({
        signal1,
        signal2,
        ...,
        signaln
    }) // input wire [99:0] probe0
);
```
剩下的位宽，Vivado会自动补零；烧录后，ILA窗口会自动对拼接后的信号进行拆分

**3、Make Sure the clock connected to the debug hub core is a free running clock and is active**

Free running clock是指上电以后无条件运行的时钟，比如晶振，上电以后就开始起震，不需要额外的附加条件限制；而比如锁相环出来的时钟，这时除了要满足上电以外，还需要PLL没有被复位，而且输入时钟倍频后的VCO在一定范围内，等诸多限制条件的满足，clk才能正常输出，所以PLL输出时钟就不是Free running clock

Vivado下载完bit文件以后，会扫描ila，一旦检测不到ila时钟就会报错或警告

如果时钟在下载完成后没有，但是经过短暂的时候会有，这样导致一开始Vivado扫描不到时钟，这种情况先一般只会报warning，同时ila相关的信号刷新不出来，这个时候在debug界面下，点击refresh一下，让Vivado再次扫描一下ila，就可以看见ltx文件里面的信号了

或者ila的clk并没有连接上，也可能连接的时钟并没有起震，此时会报err，先去查看时钟是否正常或者时钟有没有其它的附加条件没满足

